jQuery(function(y){"use strict";y.fn.yith_wcbk_datepicker=function(){var t=new Date,g=new Date(t.getFullYear(),t.getMonth(),t.getDate()),p=function(t){var e=t.data("type"),a=y(t.data("related-from"));return t="to"===e&&0<a.length?a:t},m=function(t){return{all_day:(t=p(t)).data("all-day"),allow_same_date:t.data("allow-same-date")||"yes",ajax_load_months:t.data("ajax-load-months"),month_to_load:t.data("month-to-load"),year_to_load:t.data("year-to-load"),min_duration:t.data("min-duration"),notAvailableDates:t.data("not-available-dates")||[],product_id:t.data("product-id"),is_static:t.data("static")||"no",loadedMonths:t.data("loaded-months")||[],monthsToLoad:t.data("months-to-load")||1}};return y(this).each(function(){var l=y(this),a=l.parent(".yith-wcbk-date-range-picker"),s=l.data("type"),t=l.data("min-date"),e=l.data("max-date"),i=l.data("number-of-months")||1,c=y(l.data("related-to")),n=y(l.data("on-select-open")),_=y(l.data("related-from")),o=l.next(".yith-wcbk-date-picker--formatted"),d=y(l.data("update-on-change")),h=!1,k="yes"===l.data("disable-after-non-available-date")&&"to"===s,r=function(t,e){e=e||0;var a,i,n=m(l);0<c.length&&(i="yes"===bk.settings.check_min_max_duration_in_calendar?n.min_duration:1,"yes"===n.allow_same_date&&--i,a=0<i?yith_wcbk_dates.add_days_to_date(t,i):t,c.val()&&yith_wcbk_dates.date_diff(c.val(),a)<0&&c.datepicker("setDate",null),e?setTimeout(function(){c.datepicker("option","minDate",a)},e):c.datepicker("option","minDate",a))},t=(l.datepicker({dateFormat:"yy-mm-dd",minDate:t,maxDate:e,showAnim:!1,showButtonPanel:!0,closeText:yith_wcbk_datepicker_params.i18n_clear,altField:o,altFormat:bk.settings.datepickerFormat,numberOfMonths:i,popup:{position:"bottom left",origin:"top left"},beforeShow:function(t,e){h=!1,l.addClass("yith-wcbk-datepicker--opened"),a.length&&(a.addClass("yith-wcbk-date-range-picker--opened"),s)&&a.addClass("yith-wcbk-date-range-picker--opened-"+s),y("#ui-datepicker-div").addClass("yith-wcbk-datepicker").addClass("notranslate"),"yes"===m(l).is_static&&y("#ui-datepicker-div").addClass("yith-wcbk-datepicker--static").appendTo(l.parent().parent()),e.yith_booking_date_selected=!1,setTimeout(function(){y(".ui-datepicker-close").on("click",function(){l.datepicker("setDate",null).trigger("change")})},10)},beforeShowDay:function(t){var e,a,i=!0,n=l.data("allowed-days")||[],o=m(l),d=[],r=!("to"!==s||!_.length)&&_.datepicker("getDate");return 1900<t.getFullYear()&&15===t.getDate()&&(a=p(l),function(t,e,a){a=m(l=a),t=t+"-"+(9<e?e:"0"+parseInt(e,10));return!a.loadedMonths.includes(t)}(t.getFullYear(),t.getMonth()+1,l))&&(!function(t,e,a){a=m(l=a);if("yes"===a.ajax_load_months){a=a.year_to_load+"-"+a.month_to_load+"-01";if(0===yith_wcbk_dates.date_diff(t+"-"+e+"-01",a,"months"))return!0}return!1}(t.getFullYear(),t.getMonth()+1,l)?l.trigger("yith_wcbk_datepicker_load_non_available_dates_in_month",[a,o,t.getFullYear(),t.getMonth()+1]):l.trigger("yith_wcbk_datepicker_update_non_available_dates",[a,o])),(i=i&&k&&h&&t.getTime()>=h.getTime()?!1:i)&&0<n.length&&(a=t.getDay(),i=-1!==n.indexOf(a=0===a?7:a)),i&&0<o.notAvailableDates.length&&(e="yes"===bk.settings.check_min_max_duration_in_calendar?o.min_duration:1,"yes"===o.all_day&&--e,a="to"===s?yith_wcbk_dates.add_days_to_date(t,-e):t,n=yith_wcbk_dates.formatDate(a),i=-1===o.notAvailableDates.indexOf(n)),!i&&t.getTime()>g.getTime()&&(d.push("bk-non-available-date"),"to"!==s||r&&t.getTime()>r.getTime()+yith_wcbk_dates.DAY_IN_MILLISECONDS*e)&&(h=h||new Date(t)),"from"===s&&c.length&&yith_wcbk_dates.formatDate(t)===c.val()&&d.push("bk-to-date"),"to"===s&&_.length&&yith_wcbk_dates.formatDate(t)===_.val()&&d.push("bk-from-date"),[i,d.join(" ")]},onClose:function(t,e){y("#ui-datepicker-div").removeClass("yith-wcbk-datepicker").removeClass("notranslate"),"yes"===m(l).is_static&&y("#ui-datepicker-div").removeClass("yith-wcbk-datepicker--static").appendTo(y("body")),e.yith_booking_date_selected&&0<n.length&&!n.val()&&(n.trigger("focus"),setTimeout(function(){n.trigger("focus")},50)),l.removeClass("yith-wcbk-datepicker--opened"),a.length&&(a.removeClass("yith-wcbk-date-range-picker--opened"),s)&&a.removeClass("yith-wcbk-date-range-picker--opened-"+s)},onSelect:function(t,e){t&&(r(t),e.yith_booking_date_selected=!0),y(this).trigger("change")}}),o.on("focus",function(){l.trigger("focus")}),l.parent().find(".yith-wcbk-booking-date-icon")),u=!1;t.on("mousedown",function(){u=!!l.datepicker("widget").is(":visible")}).on("click",function(){u||l.trigger("focus")}),l.is(".yith-wcbk-date-picker--inline")&&l.val(l.data("value")),l.val()&&(l.datepicker("setDate",l.val()+" 00:00:00"),r(l.val(),100)),d.length&&(l.on("change",function(){d.val(y(this).val())}),d.val(l.val()))})}});